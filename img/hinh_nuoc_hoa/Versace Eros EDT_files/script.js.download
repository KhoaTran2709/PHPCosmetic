// Biến khởi tạo
var view_collection = true;
var viewout = true;
var timeOut_modalCart;
var check_show_modal = true;
var timeOut_tabIndex;
var check_show_tabIndex = true;
var cur_scrollTop = 0;
if ( typeof(formatMoney) == 'undefined' ){
	formatMoney = '';
}
var check_header_fixTop = false;

// Fixheight product
function fixHeightProduct(data_parent, data_target, data_image) {
	var box_height = 0;
	var box_image = 0;
	var boxtarget = data_parent + ' ' + data_target;
	var boximg = data_parent + ' ' + data_target + ' ' + data_image;
	jQuery(boximg).css('height', 'auto');
	jQuery($(boxtarget)).css('height', 'auto');
	jQuery($(boxtarget)).removeClass('fixheight');
	jQuery($(boxtarget)).each(function() {
		if (jQuery(this).find($(data_image)).height() > box_image) {
			box_image = jQuery(this).find($(data_image)).height();
		}
	});
	if (box_image > 0) {
		jQuery(boximg).height(box_image);
	}
	jQuery($(boxtarget)).each(function() {
		if (jQuery(this).height() > box_height) {
			box_height = jQuery(this).height();
		}
	});
	jQuery($(boxtarget)).addClass('fixheight');
	if (box_height > 0) {
		jQuery($(boxtarget)).height(box_height);
	}
	try {
		fixheightcallback();
	} catch (ex) {}
}

// Change grid list in collection
function changeTemplate(element) {
	if ( $(element).hasClass('active') ) {

	} else {
		$('#event-grid > div:not(.clear-ajax)').hide();
		$('.box-product-lists > .loadmore, .box-product-lists > .pagination-default').hide();
		$('.icons-loading').show();
		$('.btn-change-list').removeClass('active');
		$(element).addClass('active');
		if( $(element).attr('data-template') == 'template-list' ) {
			$('#event-grid').addClass('template-list');
		} else {
			$('#event-grid').removeClass('template-list');
		}
	}
	jQuery('#event-grid').imagesLoaded(function() {
		$('.icons-loading').hide();
		jQuery(window).resize();
		$('#event-grid > div:not(.clear-ajax)').show();
		$('.box-product-lists > .loadmore, .box-product-lists > .pagination-default').show();
	});
}

// Keyup find item in list filter collection
function filterItemInList(object) {
	q = object.val().toLowerCase();
	object.parent().next().find('li').show();
	if (q.length > 0) {
		object.parent().next().find('li').each(function() {
			if ($(this).find('label').attr("data-filter").indexOf(q) == -1)
				$(this).hide();
		})
	}
}

// Check owl item next/prev show or hide
function checkItemOwlShow(object,tab,a,b,c,d) {
	if ( tab == 'tab' ) {
		item = object.find('.active').find('.owl-carousel');
	} else {
		item = object.find('.owl-carousel');
	}	
	if ( item.find('.owl-item.active').length < a && $(window).width() >= 1200 ) {
		item.find('.owl-controls').hide();
	}
	if ( item.find('.owl-item.active').length < b && $(window).width() >= 992 && $(window).width() < 1199 ) {
		item.find('.owl-controls').hide();
	}
	if ( item.find('.owl-item.active').length < c && $(window).width() >= 768 && $(window).width() < 991 ) {
		item.find('.owl-controls').hide();
	}
	if ( item.find('.owl-item.active').length < d && $(window).width() < 768 ) {
		item.find('.owl-controls').hide();
	}
}

// Destroy resize image
function destroyResize(url){
	if ( url != undefined ) {
		if ( url.indexOf('_pico') != -1 || url.indexOf('_icon') != -1 || url.indexOf('_thumb') != -1
				|| url.indexOf('_small') != -1 || url.indexOf('_compact') != -1 || url.indexOf('_medium') != -1
				|| url.indexOf('_large') != -1 || url.indexOf('_grande') != -1 || url.indexOf('_1024x1024') != -1
				|| url.indexOf('_2048x2048') != -1 || url.indexOf('_master') != -1 ) {		
			link_image = (url.split('_')[url.split('_').length - 1]).split('.')[0];
			switch (link_image) {
				case 'pico': 
					link_image = url.split('_pico').join('').replace('http:','').replace('https:','');;
					break;
				case 'icon': 
					link_image = url.split('_icon').join('').replace('http:','').replace('https:','');;
					break;
				case 'thumb': 
					link_image = url.split('_thumb').join('').replace('http:','').replace('https:','');;
					break;
				case 'small':
					link_image = url.split('_small').join('').replace('http:','').replace('https:','');; 
					break;
				case 'compact': 
					link_image = url.split('_compact').join('').replace('http:','').replace('https:','');;
					break;
				case 'medium': 
					link_image = url.split('_medium').join('').replace('http:','').replace('https:','');;
					break;
				case 'large': 
					link_image = url.split('_large').join('').replace('http:','').replace('https:','');;
					break;
				case 'grande': 
					link_image = url.split('_grande').join('').replace('http:','').replace('https:','');;
					break;
				case '1024x1024': 
					link_image = url.split('_1024x1024').join('').replace('http:','').replace('https:','');;
					break;
				case '2048x2048': 
					link_image = url.split('_2048x2048').join('').replace('http:','').replace('https:','');;
					break;
				case 'master':
					link_image = url.split('_master').join('').replace('http:','').replace('https:','');;
					break;
			}
			return link_image;
		}
		return url;
	}
}

// Modal Cart
function getCartModal(){
	var cart = null;
	jQuery('#cartform').hide();
	jQuery('#myCart #exampleModalLabel').text("Giỏ hàng");
	jQuery.getJSON('/cart.js', function(cart, textStatus) {
		if(cart)
		{
			jQuery('#cartform').show();
			jQuery('.line-item:not(.original)').remove();
			jQuery.each(cart.items,function(i,item){
				var total_line = 0;
				var total_line = item.quantity * item.price;
				tr = jQuery('.original').clone().removeClass('original').appendTo('table#cart-table tbody');
				if(item.image != null)
					tr.find('.item-image').html("<img src=" + Haravan.resizeImage(item.image,'small') + ">");
				else
					tr.find('.item-image').html("<img src='//hstatic.net/0/0/global/noDefaultImage6_large.gif'>");
				vt = item.variant_options;
				if(vt.indexOf('Default Title') != -1)
					vt = '';
				tr.find('.item-title').children('a').html(item.product_title + '<br><span>' + vt + '</span>').attr('href', item.url);
				tr.find('.item-quantity').html("<input id='quantity1' name='updates[]' min='1' type='number' value=" + item.quantity + " class='' />");
				if ( typeof(formatMoney) != 'undefined' ){
					tr.find('.item-price').html(Haravan.formatMoney(total_line, formatMoney));
				}else {
					tr.find('.item-price').html(Haravan.formatMoney(total_line, ''));
				}
				tr.find('.item-delete').html("<a href='javascript:void(0);' onclick='deleteCart(" + item.variant_id + ")' ><i class='fa fa-times'></i></a>");
			});
			jQuery('.item-total').html(Haravan.formatMoney(cart.total_price, formatMoney));
			jQuery('.modal-title').children('b').html(cart.item_count);
			jQuery('.icon-cart').children('.count-cart').html(cart.item_count);
			jQuery('.cart-number').html(cart.item_count + ' sản phẩm');
			if(cart.item_count == 0){				
				jQuery('#exampleModalLabel').html('Giỏ hàng của bạn đang trống. Mời bạn tiếp tục mua hàng.');
				jQuery('#cart-view').html('<tr><td>Hiện chưa có sản phẩm</td></tr>');
				jQuery('#cartform').hide();
			}
			else{			
				jQuery('#exampleModalLabel').html('Bạn có ' + cart.item_count + ' sản phẩm trong giỏ hàng.');
				jQuery('#cartform').removeClass('hidden');
				jQuery('#cart-view').html('');
			}
			if ( jQuery('#cart-pos-product').length > 0 ) {
				jQuery('#cart-pos-product span').html(cart.item_count + ' sản phẩm');
			}
			// Get product for cart view
jQuery.ajax({
								 url: '/cart?view=viewmini',
								 success:function(data){
									 $("#cart-view").html(data)
								 }
							 });
			jQuery.each(cart.items,function(i,item){
				//clone_item(item);
			});
			jQuery('#total-view-cart').html(Haravan.formatMoney(cart.total_price, formatMoney));
		}
		else{
			jQuery('#exampleModalLabel').html('Giỏ hàng của bạn đang trống. Mời bạn tiếp tục mua hàng.');
			if ( jQuery('#cart-pos-product').length > 0 ) {
				jQuery('#cart-pos-product span').html(cart.item_count + ' sản phẩm');
			}
			jQuery('#cart-view').html('<tr><td>Hiện chưa có sản phẩm</td></tr>');
			jQuery('#cartform').hide();
		}
	});
	
}

function clone_item(product){
	var item_product = jQuery('#clone-item-cart').find('.item_2');
	item_product.find('img').attr('src',Haravan.resizeImage(product.image,'small')).attr('alt', product.url);
	item_product.find('a').attr('href', product.url).attr('title', product.url);
	item_product.find('.pro-title-view').html(product.title);
	item_product.find('.pro-quantity-view').html('Số lượng: ' + product.quantity);
	item_product.find('.pro-price-view').html('Giá: ' + Haravan.formatMoney(product.price,formatMoney));
	item_product.clone().removeClass('hidden').prependTo('#cart-view');
}

// Delete variant in modalCart
function deleteCart(variant_id){
	var params = {
		type: 'POST',
		url: '/cart/change.js',
		data: 'quantity=0&id=' + variant_id,
		dataType: 'json',
		success: function(cart) {
			getCartModal();
		},
		error: function(XMLHttpRequest, textStatus) {
			Haravan.onError(XMLHttpRequest, textStatus);
		}
	};
	jQuery.ajax(params);
}

// Update product in modalCart
jQuery(document).on("click","#update-cart-modal",function(event){
	event.preventDefault();
	if (jQuery('#cartform').serialize().length <= 5) return;
	//jQuery(this).html('Đang cập nhật');
	var params = {
		type: 'POST',
		url: '/cart/update.js',
		data: jQuery('#cartform').serialize(),
		dataType: 'json',
		success: function(cart) {
			if ((typeof callback) === 'function') {
				callback(cart);
			} else {
				getCartModal();
			}
			//jQuery('#update-cart-modal').html('Cập nhật');
		},
		error: function(XMLHttpRequest, textStatus) {
			Haravan.onError(XMLHttpRequest, textStatus);
		}
	};
	jQuery.ajax(params);
});
jQuery(document).on("change",'input#quantity1',function(e){
	$('#update-cart-modal').trigger('click');
})
// Add a product in checkout
var buy_now = function(id) {
	var quantity = 1;
	var params = {
		type: 'POST',
		url: '/cart/add.js',
		data: 'quantity=' + quantity + '&id=' + id,
		dataType: 'json',
		success: function(line_item) {
			window.location = '/checkout';
		},
		error: function(XMLHttpRequest, textStatus) {
			Haravan.onError(XMLHttpRequest, textStatus);
		}
	};
	jQuery.ajax(params);
}

// Add a product in cart
var add_item = function(id) {
	var quantity = 1;
	var params = {
		type: 'POST',
		url: '/cart/add.js',
		data: 'quantity=' + quantity + '&id=' + id,
		dataType: 'json',
		success: function(line_item) {
			window.location = '/cart';
		},
		error: function(XMLHttpRequest, textStatus) {
			Haravan.onError(XMLHttpRequest, textStatus);
		}
	};
	jQuery.ajax(params);
}

// Add a product and show modal cart
var add_item_show_modalCart = function(id) {
	if( check_show_modal ) {
		check_show_modal = false;
		timeOut_modalCart = setTimeout(function(){ 
			check_show_modal = true;
		}, 3000);
		if ( $('.addtocart-modal').hasClass('clicked_buy') ) {
			var quantity = $('#quantity').val();
		} else {
			var quantity = 1;
		}
		var params = {
			type: 'POST',
			url: '/cart/add.js',
			async: true,
			data: 'quantity=' + quantity + '&id=' + id,
			dataType: 'json',
			success: function(line_item) {

				if ( jQuery(window).width() >= 768 ) {
					getCartModal();					
					//jQuery('#myCart').modal('show');				
					//jQuery('.modal-backdrop').css({'height':jQuery(document).height(),'z-index':'99'});
					$.getJSON('/cart.js', function(data){
						$('.count-cart').html(data.item_count);
					})
				} else {
					window.location = '/cart';
				}
				$('.addtocart-modal').removeClass('clicked_buy');
			},
			error: function(XMLHttpRequest, textStatus) {
				Haravan.onError(XMLHttpRequest, textStatus);
			}
		};
		jQuery.ajax(params);
	}
}

// Plus number quantiy product detail 
var plusQuantity = function() {
	if ( jQuery('input[name="quantity"]').val() != undefined ) {
		var currentVal = parseInt(jQuery('input[name="quantity"]').val());
		if (!isNaN(currentVal)) {
			jQuery('input[name="quantity"]').val(currentVal + 1);
		} else {
			jQuery('input[name="quantity"]').val(1);
		}
	}else {
		console.log('error: Not see elemnt ' + jQuery('input[name="quantity"]').val());
	}
}

// Minus number quantiy product detail 
var minusQuantity = function() {
	if ( jQuery('input[name="quantity"]').val() != undefined ) {
		var currentVal = parseInt(jQuery('input[name="quantity"]').val());
		if (!isNaN(currentVal) && currentVal > 1) {
			jQuery('input[name="quantity"]').val(currentVal - 1);
		}
	}else {
		console.log('error: Not see elemnt ' + jQuery('input[name="quantity"]').val());
	}
}

// Change handleize
var slug = function(str) {
	str = str.toLowerCase();
	str = str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g, "a");
	str = str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g, "e");
	str = str.replace(/ì|í|ị|ỉ|ĩ/g, "i");
	str = str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g, "o");
	str = str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g, "u");
	str = str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g, "y");
	str = str.replace(/đ/g, "d");
	str = str.replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'| |\"|\&|\#|\[|\]|~|$|_/g, "-");
	str = str.replace(/-+-/g, "-"); //thay thế 2- thành 1- 
	str = str.replace(/^\-+|\-+$/g, "");
	return str;
}

// Resize image article thumb for blog home
var imageThumbResize = function(){
	if ( jQuery('.lists-thumb-resize .box-thumb-resize').length > 1 ) {
		var height_thumb_resize = 0;
		jQuery.each(jQuery('.lists-thumb-resize .box-thumb-resize'),function(i,v){
			if ( jQuery(this).find('.image-thumb-resize').height() > height_thumb_resize ) {
				height_thumb_resize = jQuery(this).find('.image-thumb-resize').height();
			}
		});
		jQuery('.lists-thumb-resize .box-thumb-resize .image-thumb-resize').css('height',height_thumb_resize);
	}
}
// Resize image article thumb for blog home
var imageBlogResize = function(){
	if ( jQuery('.lists-blog-resize').length > 1 ) {
		var height_blog_resize = 0;
		jQuery.each(jQuery('.lists-blog-resize .image-blog-resize'),function(i,v){
			if ( jQuery(this).height() > height_blog_resize ) {
				height_blog_resize = jQuery(this).height();
			}
		});
		jQuery('.lists-blog-resize .image-blog-resize').css('height',height_blog_resize);
	}
}

jQuery(document).ready(function(){

	// Image Product Loaded fix height
	/*jQuery('.box-product-lists .image-resize').imagesLoaded(function() {
		fixHeightProduct('.box-product-lists','.product-resize','.image-resize');
		jQuery(window).resize(function() {
			fixHeightProduct('.box-product-lists','.product-resize','.image-resize');
		});
	});*/

	jQuery('.product-comments .tab-content > div').eq(0).addClass('active');
	$('#navbar li').hover(function(){
		$(this).toggleClass('open');
	});

	jQuery('.product-comments .tab-content > div').eq(0).addClass('active');

	$(document).on("click", "#trigger", function(){
		if (!$('body').hasClass('responsive')) {
			//$('body').addClass('responsive helper-overflow-hidden');
			$('html').addClass('helper-overflow-hidden');
			$(window).scrollTop(0);
			//$('body').removeClass('hideresponsive');
		}
		else {
			$("body").removeClass("responsive").removeClass("helper-overflow-hidden");
			$('html').removeClass('helper-overflow-hidden');
			$('body').addClass('hideresponsive');
		}
	});

	$(document).on("click", ".responsive #mp-pusher", function(){
		$("body").removeClass("responsive").removeClass("helper-overflow-hidden");
		$('html').removeClass('helper-overflow-hidden');
		$('body').addClass('hideresponsive');
	});

	$(document).on("click", "#menu-mb li.has-child i", function(){
		var id = $(this).siblings('a').data('id')
		$('.submenu-mb').show();
		$('.menumain-mb').addClass('pusher');
		$('.submenu-level1-children').removeClass('active');
		$('#'+id).addClass('active');
		jQuery('#menu-mb').animate({
			scrollTop: $('#inner-menu-mb').offset().top	
		}, 600);
	});
	$(document).on('click','.btn-close-menu',function(e){
		$('html').removeClass('helper-overflow-hidden');
		$('.menumain-mb').removeClass('pusher');
		$('.submenu-level1-children').removeClass('active');
	})
	$(document).on('click','.back-main',function(e){
		$(this).parents('.submenu-level1-children').removeClass('active');
		$('.menumain-mb').removeClass('pusher');
		$('.submenu-mb').hide();
	})
	// Scroll Top
	jQuery(document).on("click", ".back-to-top", function(){
		jQuery(this).removeClass('display');
		jQuery('html, body').animate({
			scrollTop: 0			
		}, 600);
	});

	// Event click dropdown catalog mobile
	jQuery(document).ready(function () {
		if(jQuery(window).width() <= 991){
			jQuery(document).on("click", ".title-category", function(){
				if ( jQuery(this).find('.event-drop-list').hasClass('fa-angle-up') ){
					jQuery(this).find('.event-drop-list').removeClass('fa-angle-up').addClass('fa-angle-down');
					jQuery(this).parents('.box-section-collection').find('.tab-cates').css('margin-bottom','0px').slideUp('normal');
				}else {
					jQuery(this).find('.event-drop-list').removeClass('fa-angle-down').addClass('fa-angle-up');
					jQuery(this).parents('.box-section-collection').find('.tab-cates').css('margin-bottom','10px').slideDown('normal');
				}
			});
		}
		jQuery('.footer-block .menu-title').on('click', function(){
			if (jQuery(window).width() < 768) {
				jQuery(this).parent().find('.toggle-footer').stop().slideToggle('medium');
				jQuery(this).toggleClass('active');
			}
		});
	});

	// Add attribute data-spy=scroll in element <a> when you click, it'll scroll to href="#abc"
	jQuery(document).on("click", "a[data-spy=scroll]", function(e) {
		var height = 200;
		if($('.detail-top').hasClass('.fix-top')){
			var height = $('.detail-top.fix-top').height() + 50;
		}

		e.preventDefault();
		jQuery('html,body').animate({scrollTop: (jQuery(jQuery(this).attr('href')).offset().top - height) + 'px'}, 700);
	});


	// Add a product when you change variant in cart ( product detail )
	jQuery(document).on("click", "#buy-now", function(e) {
		e.preventDefault() ;
		var params = {
			type: 'POST',
			url: '/cart/add.js',
			data: jQuery('#add-item-form').serialize(),
			dataType: 'json',
			success: function(line_item) {
				window.location = '/checkout';
			},
			error: function(XMLHttpRequest, textStatus) {
				Haravan.onError(XMLHttpRequest, textStatus);
			}
		};
		jQuery.ajax(params);
	});
	// Active image thumb and change image featured ( product detail )
	jQuery(document).on("click", ".product-thumb:not(.active)", function() {
		jQuery(this).addClass('active').siblings('.product-thumb').removeClass('active');
		if(jQuery(this).hasClass('video-thumb')){
			var img = $('.product-image-feature');
			if(img.hasClass('inited')){
				jQuery('.zoomContainer').remove();
				img.removeData('elevateZoom');
				img.removeData('zoomImage');
			}
			jQuery('.box-video-product').addClass('show-video');
			$('.box-video-product iframe')[0].contentWindow.postMessage('{"event":"command","func":"' + 'playVideo' + '","args":""}', '*');    
		} else {
			if(jQuery('.box-video-product').hasClass('show-video')){				 
				$('.box-video-product iframe')[0].contentWindow.postMessage('{"event":"command","func":"' + 'pauseVideo' + '","args":""}', '*');  
				jQuery('.box-video-product').removeClass('show-video');
			}
			jQuery(".product-image-feature").attr("src",jQuery(this).children('a').attr("data-image"));
			jQuery(".product-image-feature").attr("data-zoom-image",jQuery(this).children('a').attr("data-image"));
			if(jQuery(window).width() >= 1200){
				var img = $('.product-image-feature');
				if(img.hasClass('inited')){
					jQuery('.zoomContainer').remove();
					img.removeData('elevateZoom');
					img.removeData('zoomImage');
				}
				img.addClass('inited').elevateZoom();
			}
		}
	});

	// Click change slide next image featured ( product detail )
	jQuery(document).on("click", ".slide-next", function() {
		if(jQuery(".product-thumb.active").prev().length > 0){
			jQuery(".product-thumb.active").prev().click();
		}
		else{
			jQuery(".product-thumb:last-child").click();
		}
	});

	// Click change slide prev image featured ( product detail )
	jQuery(document).on("click", ".slide-prev", function() {
		if(jQuery(".product-thumb.active").next().length > 0){
			jQuery(".product-thumb.active").next().click();
		}
		else{
			jQuery(".product-thumb:first-child img").click();
		}
	});

	// Menu breadcrumb
	jQuery(document).on("hover", ".dropdown-link-breadcrumb li,.box-menu-collection li", function(e) {
		jQuery(this).toggleClass('open');
	});

	// Change group box search in header
	jQuery(document).on("click", ".change-collection-id > li > a", function() {
		jQuery(this).parents('.group-collection-search').children('button').html(jQuery(this).html() + "<span class='caret'></span>");
	});

	// Hover show group collection in header fix scroll
	jQuery(document).on("hover", ".fix-menu-collection .title-danh-muc", function(e) {
		if (e.type === "mouseenter") { 
			jQuery('ul.dropdown-menu.box-menu-collection').slideDown(300);
		} else if (e.type === "mouseleave") { 
			setTimeout(function(){
				if ( view_collection ) {		
					jQuery('ul.dropdown-menu.box-menu-collection').slideUp(300);
				}
			},600);
		}
	});
	jQuery(document).on("hover", "ul.dropdown-menu.box-menu-collection", function(e) {
		if (e.type === "mouseenter") { 
			view_collection = false;
		} else if (e.type === "mouseleave") { 
			view_collection = true;
			jQuery('ul.dropdown-menu.box-menu-collection').slideUp(300);
		}
	});

	// Click active icon index 
	jQuery(document).on("click", "#category_icon_floor li", function() {
		jQuery('#category_icon_floor li.active');
		jQuery('#category_icon_floor li').removeClass('active');
		jQuery(this).addClass('active');
	});

	// Event slider
	var owl_data = jQuery("#slider-menu .owl-carousel").data('owlCarousel');
	jQuery('#slider-thumb li .slider-image-thumb').click(function(){
		jQuery(this).parent('li').addClass('click-event');
		jQuery('#slider-thumb li').removeClass('active');
		jQuery(this).parent('li').addClass('active');
		var index = jQuery(this).parent('li').index();
		owl_data.to(index);
	});

	jQuery('#slider-thumb li').hover(
		function(){
			var index = jQuery(this).index();
			var obj = jQuery(this);
			if( obj.hasClass('click-event') ){
			} else {
				obj.addClass('click-event');
				jQuery('#slider-thumb li').removeClass('active');
				obj.addClass('active');
				owl_data.to(index);
			}
		},
		function(){
			var index = jQuery(this).index();
			var obj = jQuery(this);
		}
	);

	// Fix height image for blog home
	imageThumbResize();
	imageBlogResize();

	// Ajax get product in collection for page home
	$('#ajax-tab-collection').tabdrop({text: '<i class="fa fa-bars"></i>'});
	if($(window).width() < 1199){
		//$('#tab-product-template').tabdrop({text: '<i class="fa fa-bars"></i>'});
	}
	jQuery(document).on("click", "#ajax-tab-collection > li:not(.tabdrop), #ajax-tab-collection li .dropdown-menu > li", function(e) {
		var handle = jQuery(this).children('a').attr('data-handle');
		jQuery('.tabs-products .tab-item.active').find('.icons-loading.tab-index').show();
		if ( jQuery('.tabs-products .tab-item.active').attr('data-get') == 'false' && handle != '' ) {
			jQuery.ajax({
				url: 'collections/' + handle + '?view=filter-tab-home&page=1',
				success:function(data){
					$('.icons-loading.tab-index').hide();
					jQuery('.tabs-products .tab-item.active').attr('data-get','true').children('.owl-carousel').append(data);						
					jQuery('.tabs-products .tab-item.active').imagesLoaded(function() {
						var owl_tab = jQuery('.tabs-products .tab-item.active .owl-carousel');
						owl_tab.owlCarousel({
							items:5,
							nav:true,
							loop: true,
							margin: 15,
							responsive:{
								0:{
									items:2								
								},
								768:{
									items:3
								},
								992:{
									items:4
								},
								1200:{
									items:5
								}
							}
						});
						owl_tab.find('.owl-next');
						owl_tab.find('.owl-prev');
						checkItemOwlShow($('.tabs-products'),'tab',5,4,3,2);
					});
					jQuery(window).resize();
				}
			});
		}
		jQuery('.tabs-products .tab-item.active').find('.icons-loading.tab-index').hide();
		if ( jQuery('.tabs-products .tab-item.active').attr('data-get') == 'false' && handle == '' ) {				
			jQuery('.tabs-products .tab-item.active').attr('data-get','true').children('.owl-carousel').removeClass('product-lists').show().append("<div class='alertNoProduct'>Hiện tại cửa hàng mình đang cập nhật dữ liệu</div>");
		}
	});

	// Scroll show icon section index
	jQuery(window).on("scroll", function() {
		/* Xữ lý scroll change icon section */
		if ( jQuery('.box-section-collection').last().length > 0 ) {
			var pos_current = jQuery(window).scrollTop();
			if ( pos_current > jQuery('.box-section-collection').last().offset().top || pos_current < jQuery('#header').height() + jQuery('#slider').height() + jQuery('.sale-section').height()) {
				jQuery('#category_icon_floor').removeClass('affix').addClass('affix-top');
			}else {
				var icon_left = (jQuery(window).width() - jQuery('.container').width())/2 - 40;
				jQuery('#category_icon_floor').removeClass('affix-top').addClass('affix').css('left',icon_left);				
			}
			if ( jQuery('#section_1').length > 0 ) {
				if( jQuery(window).scrollTop() > jQuery('#section_1').offset().top - 150 ) {
					jQuery('#scroll-left-price li.active').removeClass('active');
					jQuery('#scroll-left-price li').eq(0).addClass('active');
					jQuery('#category_icon_floor li').removeClass('active');
					jQuery('#category_icon_floor li').eq(0).addClass('active');
				}
			}
			if ( jQuery('#section_2').length > 0 ) {
				if( jQuery(window).scrollTop() > jQuery('#section_2').offset().top - 280 ) {
					jQuery('#scroll-left-price li.active').removeClass('active');
					jQuery('#scroll-left-price li').eq(1).addClass('active');
					jQuery('#category_icon_floor li').removeClass('active');
					jQuery('#category_icon_floor li').eq(1).addClass('active');
				}
			}
			if ( jQuery('#section_3').length > 0 ) {
				if( jQuery(window).scrollTop() > jQuery('#section_3').offset().top - 280 ) {
					jQuery('#scroll-left-price li.active').removeClass('active');
					jQuery('#scroll-left-price li').eq(2).addClass('active');
					jQuery('#category_icon_floor li').removeClass('active');
					jQuery('#category_icon_floor li').eq(2).addClass('active');
				}
			}
			if ( jQuery('#section_4').length > 0 ) {
				if( jQuery(window).scrollTop() > jQuery('#section_4').offset().top - 280 ) {
					jQuery('#scroll-left-price li.active').removeClass('active');
					jQuery('#scroll-left-price li').eq(3).addClass('active');
					jQuery('#category_icon_floor li').removeClass('active');
					jQuery('#category_icon_floor li').eq(3).addClass('active');
				}
			}
			if ( jQuery('#section_5').length > 0 ) {
				if( jQuery(window).scrollTop() > jQuery('#section_5').offset().top - 280 ) {
					jQuery('#scroll-left-price li.active').removeClass('active');
					jQuery('#scroll-left-price li').eq(4).addClass('active');
					jQuery('#category_icon_floor li').removeClass('active');
					jQuery('#category_icon_floor li').eq(4).addClass('active');
				}
			}
		}

		/* Process scroll btn addtocart in product */
		if ( jQuery('.btn-position').length > 0 ) {
			if( jQuery(window).scrollTop() > jQuery('.addtocart-modal').offset().top ) {
				jQuery('.btn-position').show('slow');
			}else {
				jQuery('.btn-position').hide('slow');
			}
		}
		/* Scroll to top */
		if ( jQuery('.back-to-top').length > 0 && jQuery(window).scrollTop() > 500 ) {
			jQuery('.back-to-top').addClass('display');
		} else {
			jQuery('.back-to-top').removeClass('display');
		}

	});

	/******* Event searchbox with collection *******/
	/*jQuery('.btn-searchbox').click(function(e){
		e.preventDefault();
		query = '';
		value_input = $(this).parents('form').find('input[name=q]').val();
		if ($('#dropdown-collection').attr('data-id') == undefined) {
			query = '(collectionid:product>0)&&(title:product**' + value_input + ')';
		} else {
			query = '(collectionid:product=' + $('#dropdown-collection').attr('data-id') + ')&&(title:product**' + value_input + ')';
		}
		window.location = '/search?q=filter=(' + encodeURIComponent(query) + ')';
	});*/

});

//Tooltips
jQuery(document).ready(function(){

	jQuery('.item-inner').hover(function() {
		jQuery(this).find('a .title_tooltip').each(function() {
			var t = jQuery(this)
			, t_p = t.parent()
			, t_pp = t.parent().parent()
			, t_inner = t.closest('.item-inner')
			, t_ppOffset = t_pp.offset()
			, t_pOffset = t_p.offset()
			, t_width = t.outerWidth()
			, t_pWidth = t_p.outerWidth()
			, t_ppWidth = t_pp.outerWidth()
			, t_innerWidth = t_inner.width();
			var space_inner = (t_width - t_pWidth) / 2
			, offset_compare_parent = t_pOffset.left - t_ppOffset.left
			, space = (t_innerWidth - t_ppWidth) / 2 + offset_compare_parent
			, left = offset_compare_parent + (t_pWidth / 2) - (t_width / 2)
			, top = -31 + (t_pOffset.top - t_ppOffset.top);
			if (t_width < t_innerWidth) {
				if (space_inner > space) {
					left = left - (space - space_inner);
				}
				var check_right = left + (t_innerWidth - t_ppWidth) / 2 + t_width;
				if (check_right > t_innerWidth) {
					left = left - (check_right - t_innerWidth);
				}
				t.css({
					'left': left,
					'top': top,
					'right': 'auto'
				});
			} else {
				left = (t_ppWidth - t_innerWidth) / 2;
				t.css({
					'left': left,
					'max-width': t_innerWidth,
					'top': top,
					'right': 'auto'
				});
			}
		});
	});
});



/*=======================================*/
var HRT = {
	init: function() {
		var that = this;
		that.initViews();
	},
	initViews: function() {
		var view = window.template,
				that = this;
		switch (view) {
			case 'index':
			case 'index.slider':
			case 'index.noslider':

				break;
			case 'collection':
				break;
			case 'product':
				break;
			case 'search':
				break;
			case 'blog':
				break;
			case 'article':
				that.Article.init();
				break;
			case 'page':
				break;
			case 'page.ldp-kids-01':
				that.LdpKids01.init();
				break;

			case 'cart':
				break;
			default:
		}
	},
	
};

var nCount = 0;
$('.ldpage-kids01-collection').each(function(){
	nCount += $(this).find('.nav-tabs li').length;
});

HRT.Article = {
	init: function() {
		this.tbOfContentsArt();
	},	
	tbOfContentsArt: function(){
		function urlfriendly (slug) {
			//Đổi chữ hoa thành chữ thường
			//Đổi ký tự có dấu thành không dấu
			slug = slug.toLowerCase();
			slug = slug.trim().replace(/á|à|ả|ạ|ã|ă|ắ|ằ|ẳ|ẵ|ặ|â|ấ|ầ|ẩ|ẫ|ậ/gi, 'a');
			slug = slug.replace(/é|è|ẻ|ẽ|ẹ|ê|ế|ề|ể|ễ|ệ/gi, 'e');
			slug = slug.replace(/i|í|ì|ỉ|ĩ|ị/gi, 'i');
			slug = slug.replace(/ó|ò|ỏ|õ|ọ|ô|ố|ồ|ổ|ỗ|ộ|ơ|ớ|ờ|ở|ỡ|ợ/gi, 'o');
			slug = slug.replace(/ú|ù|ủ|ũ|ụ|ư|ứ|ừ|ử|ữ|ự/gi, 'u');
			slug = slug.replace(/ý|ỳ|ỷ|ỹ|ỵ/gi, 'y');
			slug = slug.replace(/đ/gi, 'd');
			//Xóa các ký tự đặt biệt
			slug = slug.replace(/\`|\~|\!|\@|\#|\||\$|\%|\^|\&|\*|\(|\)|\+|\=|\,|\.|\/|\?|\>|\<|\'|\"|\:|\;|_/gi, '_');
			//Đổi khoảng trắng thành ký tự gạch ngang
			slug = slug.replace(/ /gi, "_");
			//Đổi nhiều ký tự gạch ngang liên tiếp thành 1 ký tự gạch ngang
			//Phòng trường hợp người nhập vào quá nhiều ký tự trắng
			slug = slug.replace(/\-\-\-\-\-/gi, '_');
			slug = slug.replace(/\-\-\-\-/gi, '_');
			slug = slug.replace(/\-\-\-/gi, '_');
			slug = slug.replace(/\-\-/gi, '_');
			//Xóa các ký tự gạch ngang ở đầu và cuối
			slug = '@' + slug + '@';
			slug = slug.replace(/\@\-|\-\@|\@/gi, '');
			//In slug ra textbox có id “slug”
			return slug;
		};
		class TableOfContents {
			constructor({ from, to }) {
				this.fromElement = from;
				this.toElement = to;
				// Get all the ordered headings.
				this.headingElements = this.fromElement.querySelectorAll("h1, h2, h3,h4,h5,h6");
				this.tocElement = document.createElement("div")
			}
			/*  Get the most important heading level.
        For example if the article has only <h2>, <h3> and <h4> tags
        this method will return 2.
     */
			getMostImportantHeadingLevel() {
				let mostImportantHeadingLevel = 6; // <h6> heading level
				for (let i = 0; i < this.headingElements.length; i++) {
					let headingLevel = TableOfContents.getHeadingLevel(this.headingElements[i]);
					mostImportantHeadingLevel = (headingLevel < mostImportantHeadingLevel) ?
						headingLevel : mostImportantHeadingLevel;
				}
				return mostImportantHeadingLevel;
			}
			static generateId(headingElement) {
				return urlfriendly(headingElement.textContent)
			}
			static getHeadingLevel(headingElement) {
				switch (headingElement.tagName.toLowerCase()) {
					case "h1": return 1;
					case "h2": return 2;
					case "h3": return 3;
					case "h4": return 4;
					case "h5": return 5;
					case "h6": return 6;
					default: return 2;
				}
			}

			generateToc() {
				let currentLevel = this.getMostImportantHeadingLevel() - 1,
						currentElement = this.tocElement;
				for (let i = 0; i < this.headingElements.length; i++) {
					let headingElement = this.headingElements[i],
							headingLevel = TableOfContents.getHeadingLevel(headingElement),
							headingLevelDifference = headingLevel - currentLevel,
							linkElement = document.createElement("a");
					if (!headingElement.id) {
						headingElement.id = TableOfContents.generateId(headingElement);
					}
					linkElement.href = `#${headingElement.id}`;
					linkElement.textContent = headingElement.textContent;

					if (headingLevelDifference > 0) {
						// Go down the DOM by adding list elements.
						for (let j = 0; j < headingLevelDifference; j++) {
							let listElement = document.createElement("ul"),													
									listItemElement = document.createElement("li");
							listElement.appendChild(listItemElement);
							currentElement.appendChild(listElement);
							currentElement = listItemElement;
						}
						currentElement.appendChild(linkElement);
					} 
					else {
						// Go up the DOM.
						for (let j = 0; j < -headingLevelDifference; j++) {
							currentElement = currentElement.parentNode.parentNode;
						}
						let listItemElement = document.createElement("li");
						listItemElement.appendChild(linkElement);
						currentElement.parentNode.appendChild(listItemElement);
						currentElement = listItemElement;
					}
					currentLevel = headingLevel;
				}
				if(this.tocElement.firstChild != null){
					this.toElement.appendChild(this.tocElement.firstChild);
				}else{
					document.getElementById("table-content-container").remove();
				}
			}
		}
		(function($) {
			var stringtemplate = $('<div id="table-content-container" class="table-of-contents"><div class="table-title"><div class="htitle">Nội dung bài viết<span class="toc_toggle">[<a class="icon-list" href="javascript:void(0)">Ẩn</a>]</span></div></div></div>');
			stringtemplate.insertBefore(".article-body");

			new TableOfContents({
				from: document.querySelector(".article-body"),
				to: document.querySelector("#table-content-container")
			}).generateToc();
			$("#table-content-container .icon-list").click(function(){
				$(this).parents("#table-content-container").find("ul:first").slideToggle({ direction: "left" }, 100);
				var texxx = $(this).text();
				if(texxx == "Ẩn"){
					$(this).html("Hiện")
				}else{
					$(this).html("Ẩn")
				}
			})
			let buttontable = '<div class="table-content-fixed"><div class="table-of-header"><button class="btn-icolist"><i class="fa fa-list-ol" aria-hidden="true"></i></button> <span class="hTitle"> Nội dung bài viết</span></div><div id="clone-table" class="table-of-contents"></div></div>';
			$("#article").append(buttontable).ready(function(){
				var tablehtml = $("#table-content-container").html()
				$("#clone-table").html(tablehtml);
			});
		})(jQuery);
		$(document).ready(() =>{	
			let heighthead = $(".hSticky-nav").height() + 65;		
			$("#table-content-container ul li a,#clone-table ul li a").click(function(){
				var id = $(this).attr('href');
				$("html,body").animate({ scrollTop: $(id).offset().top - heighthead }, 600)	
			})

			$(".table-content-fixed .table-of-header").click(function(){
				$(".table-content-fixed").toggleClass('active');
			})
			if($('#table-content-container').length > 0){
				var ofsettop_ = $("#table-content-container").offset().top + 50;
				$(window).scroll(function(){
					if($(window).scrollTop() > ofsettop_){
						$(".table-content-fixed").addClass('show');
					}else{
						$(".table-content-fixed").removeClass('show');
					}
				});
			}
		})
	}
}

HRT.LdpKids01 = {
	currentPag: Array(nCount).fill(1),
	totalPag : [],
	init: function() {
		this.ajaxCollectionFlashSale();
		this.countdownFlashSale();
		this.copyCodeFlashSale();
		this.popoverCoupon();
	},	
	scrollCenterFlashSale: function(parent, elem, speed){
		var active = jQuery(parent).find(elem); 			
		var activeWidth = active.width() / 2; 
		var pos = jQuery(parent).find(elem).position().left + activeWidth; 
		var elpos = jQuery(parent).scrollLeft(); 
		var elW = jQuery(parent).width(); 		
		pos = pos + elpos - elW / 2; 
		jQuery(parent).animate({
			scrollLeft: pos
		}, speed == undefined ? 1000 : speed);
		return this;
	},
	ajaxCollectionFlashSale: function() {	
		var total_page = 0;//Tổng trang
		var isloading = false;
		var html_loadmore = '<a class="btn-loadmore" href="javascript:void(0);">Xem thêm sản phẩm</a>';

		$('.ldpage-kids01-collection').each(function(){
			var currentHandle = $(this).find('li.active a').attr('data-handle');
			var sectionCurrent = $(this);

			$(this).find('.collection-navtabs-title li a[data-toggle="tab"]').on('shown.bs.tab', function(event){
				var handle = $(this).attr('data-handle');
				var indexTab = Number($(this).attr('href').replace('#collection-tabs-',''));
				//sectionCurrent.find(".collection-navtabs-title li a[data-handle!='" + handle + "']").parent().removeClass("active");
				//sectionCurrent.find(".collection-navtabs-title li a[data-handle='" + handle + "']").parent().addClass("active");
				if(jQuery(window).width() < 768){			
					var $parentScroll = sectionCurrent.find(".collection-navtabs-title");
					HRT.LdpKids01.scrollCenterFlashSale($parentScroll,".active", 500);
				}
				sectionCurrent.find(".tab-pane.active .icon-loading.tab-index").show();
				if(sectionCurrent.find('.tab-pane.active .collection-listprod .product-loop-ldpage').length == 0){
					if(handle == '' ){
						jQuery.ajax({
							url: '/collections/all?view=ldp-kids01-noproduct',
							success:function(data){
								sectionCurrent.find(".tab-pane.active .icon-loading.tab-index").hide();
								setTimeout(function(){								
									sectionCurrent.find(".tab-pane.active .collection-loadmore").html('');
									sectionCurrent.find(".tab-pane.active").attr('data-get', 'true').find('.collection-listprod').html(data);	
									setTimeout(function(){ jQuery(window).resize();	}, 400);
								}, 200);
							}
						});
						HRT.LdpKids01.totalPag[indexTab - 1] = null;
						HRT.LdpKids01.currentPag[indexTab - 1] = null;
					}
					else{
						currentHandle = handle;	
						if(HRT.LdpKids01.totalPag[indexTab - 1] == null){
							var cur_page = 1;
							HRT.LdpKids01.currentPag[indexTab - 1] = 1;
							sectionCurrent.find('.tabslist-product-content .tab-pane.active .collection-loadmore').html(html_loadmore);
							jQuery.ajax({
								// lấy tổng số trang của kết quả filter
								url:  currentHandle + '?view=ldp-kids01-pagesize',	
								async: false,
								success:function(data){
									HRT.LdpKids01.totalPag[indexTab - 1] = parseInt(data);
									total_page = HRT.LdpKids01.totalPag[indexTab - 1];
								}
							});

							jQuery.ajax({
								url: currentHandle + '?view=ldp-kids01-data&page=1',					
								success:function(data){
									sectionCurrent.find('.icon-loading.tab-index').hide();		
									setTimeout(function(){
										sectionCurrent.find('.tabslist-product-content .tab-pane.active').attr('data-get', 'true').find('.collection-listprod').html(data);				
										if( total_page > 1){
											if(cur_page == total_page){
												sectionCurrent.find('.tab-pane.active .collection-loadmore').html('');
											} else {
												sectionCurrent.find('.tab-pane.active .collection-loadmore').html(html_loadmore);
											}
										}
										else {
											sectionCurrent.find('.tab-pane.active .collection-loadmore').html('');
										}
										setTimeout(function(){ jQuery(window).resize();	}, 400);
									}, 200);
								}
							});	
						}
					}
				}
			});
		});

		$(document).on('click', '.collection-loadmore .btn-loadmore', function(event){ 
			event.preventDefault();
			var btn = $(this);
			var idTab = $(this).parents('.tab-pane').attr('id');
			var indexTab = Number($(this).parents('.tab-pane').attr('id').replace('collection-tabs-','')) - 1;
			var cur_page = HRT.LdpKids01.currentPag[indexTab];
			currentHandle = $('.collection-navtabs-title a[href="#'+idTab+'"]').attr('data-handle');
			if(HRT.LdpKids01.totalPag[indexTab] == null || HRT.LdpKids01.totalPag.length == 0 ){
				jQuery.ajax({
					// lấy tổng số trang của kết quả filter
					url:  currentHandle + '?view=ldp-kids01-pagesize',	
					async: false,
					success:function(data){
						HRT.LdpKids01.totalPag[indexTab] = parseInt(data);
						total_page = HRT.LdpKids01.totalPag[indexTab];
					}
				});
			}
			else{
				total_page = HRT.LdpKids01.totalPag[indexTab];
			}
			cur_page++;	
			HRT.LdpKids01.currentPag[indexTab] = cur_page;

			if(!isloading && cur_page <= total_page){
				$(this).parents('.collection-loadmore').html('<a class="btn-loadmore btn-loading" href="javascript:void(0);">Xem thêm sản phẩm...</a>');
				isloading = true;			
				jQuery.ajax({
					url: currentHandle + '?view=ldp-kids01-data&page=' + cur_page,
					success:function(data){
						setTimeout(function(){ 
							$('#'+idTab).find(".collection-listprod").append(data);
							isloading = false;		
							if( total_page > 0){
								if(cur_page == total_page){
									$('#'+idTab).find('.collection-loadmore').html('');
								} else {
									$('#'+idTab).find('.collection-loadmore').html(html_loadmore);
								}
							}
							else {
								$('#'+idTab).find('.collection-loadmore').html('');
							}
						}, 500);
					}
				})
			}
			else {
				isloading = false;
				$('#'+idTab).find('.collection-loadmore').html('');
			}
		})
	},
	countdownFlashSale: function() {
		if($('.flip-js-countdown').length > 0){
			var element = document.getElementById('soon-espa');
			var time_start = $('.flip-js-countdown .auto-due').attr('data-start');
			var time_end = $('.flip-js-countdown .auto-due').attr('data-end');
			var beforeRun = new Date(time_start);	beforeRun = beforeRun.getTime();
			var afterRun = new Date(time_end);	afterRun = afterRun.getTime();
			var now = new Date();	now = now.getTime();
			function tick(milliseconds, beforeRun) {
				if (milliseconds == 0) {
					$('#label-due').html('Ưu đãi kết thúc').removeClass('hidden');
				} else {
					$('#label-due').html('Sắp diễn ra:').removeClass('hidden');
				}
			}
			function tick2(milliseconds, afterRun) {
				if (milliseconds == 0) {
					$('#label-due').html('Ưu đãi kết thúc').removeClass('hidden');
				} else {
					$('#label-due').html('Kết thúc sau:').removeClass('hidden');
				}
			}
			function complete() {
				var today = new Date();
				var cdate = today.getTime();
				if (cdate < afterRun) {
					Soon.destroy(element);
					Soon.create(element, {
						due: time_end,
						now: null,
						layout: "group label-small",
						face: "flip color-light",
						format: "d,h,m,s",
						labelsYears: null,
						labelsDays: 'Ngày',
						labelsHours: 'Giờ',
						labelsMinutes: 'Phút',
						labelsSeconds: 'Giây',
						separateChars: false,
						scaleMax: "l",
						separator: "",
						singular: true,
						paddingDays: "00",
						eventTick: tick2,
						eventComplete: function() {
							//$('.tabslist-product-countdown').hide();
						}
					});
				}
			}
			/*if(now < afterRun){}*/
			Soon.create(element, {
				due: time_start,
				now: null,
				layout: "group label-small",
				face: "flip color-light",
				format: "d,h,m,s",
				labelsYears: null,
				labelsDays: 'Ngày',
				labelsHours: 'Giờ',
				labelsMinutes: 'Phút',
				labelsSeconds: 'Giây',
				separateChars: false,
				scaleMax: "l",
				separator: "",
				paddingDays: "00",
				singular: true,
				eventTick: tick,
				eventComplete: complete
			});
		}
	},
	popoverCoupon: function(){
		var popover = '.cpi-tooltip .cpi-tooltip__dot[data-toggle="popover"]';

		$(popover).popover({
			html: true,
			animation: true,
			placement: function ( popover, trigger ){
				var placement = jQuery(trigger).attr('data-placement');
				var dataClass = jQuery(trigger).attr('data-class');
				jQuery(trigger).addClass('is-active');
				jQuery(popover).addClass(dataClass);
				if (jQuery(trigger).offset().top - $(window).scrollTop() > 280) {
					return "top";
				}
				return placement;
			}, 
			content: function() {
				var elementId  = $(this).attr("data-popover-content");
				return $(elementId).html();
			},
			delay: {show: 100, hide: 50}
		});
		$(popover).popover().on("hide.bs.popover", function(){
			$(".modal-coupon--backdrop").removeClass("js-modal-show");
		});
		$(popover).popover().on("show.bs.popover", function(){
			$(".modal-coupon--backdrop").addClass("js-modal-show");
		});
		$('body').on('hidden.bs.popover', function(e) {
			$(e.target).data('bs.popover').inState = {
				click: false,
				hover: false,
				focus: false
			};
		});
		$(document).on('click', '.popover-content__coupon .btn-popover-close,.modal-coupon--backdrop', function(e){ 		
			$(popover).popover('hide');
		});

		function eventPopover(){
			if($(window).width() >= 768){	
				$(popover).on('mouseenter', function () {
					var self = this;
					jQuery(this).popover("show");
					jQuery(".popover.coupon-popover").on('mouseleave', function () {
						jQuery(self).popover('hide');
					});
				}).on('mouseleave', function () {
					var self = this;
					setTimeout(function () {
						if (!jQuery('.popover.coupon-popover:hover').length) {
							jQuery(self).popover('hide');
						}
					},300);
				});
			}
			else{
				$(popover).off('mouseenter mouseleave');	
			}				
		};
		eventPopover();	$(window).resize(function() {	eventPopover();	});

	},
	copyCodeFlashSale: function(){
		$(document).on('click', '.coupon-item .cpi-button', function(e){ 
			e.preventDefault();	
			$('.coupon-item .cpi-button').html('Sao chép mã').removeClass('disabled');
			var copyText = $(this).attr('data-coupon');
			var el = document.createElement('textarea');	
			el.value = copyText ;
			el.setAttribute('readonly', '');
			el.style.position = 'absolute';
			el.style.left = '-9999px';
			document.body.appendChild(el);		
			el.select();
			document.execCommand('copy');
			document.body.removeChild(el);
			$(this).html('Đã sao chép').addClass('disabled');
		});
		$(document).on('click', '.popover-content__coupon .btn-popover-code', function(e){ 
			e.preventDefault();	
			var btnPopover= $(this).attr('data-coupon');
			$(".coupon-item .cpi-button[data-coupon="+btnPopover+"]").click();		
			$(this).html('Đã sao chép').addClass('disabled');	
		});
	},
}

jQuery(document).ready(function() {
	HRT.init();
});




